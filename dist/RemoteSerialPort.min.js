/*! RemoteSerialPort v0.2.0 | https://github.com/papnkukn/remote-serial-port-client | MIT license */
!function(e){function t(e){var t=this;t.events={};var n={verbose:!1,url:null,userAgent:null};if(t.options=Object.assign({},n,e||{}),!e.url)throw new Error("Missing required 'url' parameter!");if(!e.userAgent&&"function"==typeof require){var r=require("../package.json");e.userAgent="RemoteSerialPort/"+r.version}"function"==typeof o.defaults&&o.defaults({headers:{Accept:"application/json","User-Agent":e.userAgent}}),t.emit=function(e,o){var n=t.events[e];"function"==typeof n&&n(o)},t.request=function(e,n){try{o({method:e.method||"GET",url:t.options.url+e.route,headers:e.headers,body:e.body},function(e,t,o){if(n)try{if(e)throw e;var r;try{r=JSON.parse(o)}catch(e){r=o}if(t&&t.statusCode>=400)throw new Error(r.error||"HTTP Status Code "+t.statusCode);n(null,r)}catch(e){n(e)}})}catch(e){n&&n(e)}}}var o,n;if("object"==typeof exports||"function"==typeof define&&define.amd)o=require("request"),n=function(e){var t=require("ws"),o=new t(e);return o._onevent={},o._delayed=[],o._emit=function(e,t){var n=o._onevent[e];n?t?n(t):n():o._delayed.push({name:e,data:t})},o.on("open",function(){o._emit("open")}),o.on("close",function(){o._emit("close")}),o.on("message",function(e,t){o._emit("read",e)}),o.on("error",function(e){o._emit("error",event)}),o._on=o.on,o.on=function(e,t){if(!o._onevent[e])for(var n=0;o._delayed[n++];){var r=o._delayed[n];r.name==e&&(r.data?t(r.data):t()),o._delayed.splice(n,1),n--}o._onevent[e]=t},o.write=function(e){o.send(e),o._emit("write",e)},o},"node";else{if("undefined"==typeof jQuery)return console.error("RemoteSerialPort not available in this environment! Hint: try with Node.js or jQuery.");o=function(e,t){var o={cache:!1,type:e.method||"GET",url:e.url||"#",data:e.body,dataType:"json",error:function(e,o,n){t&&t(e.responseJSON,{statusCode:o},null)},success:function(e,o,n){t&&t(null,{statusCode:o},e)}};e.headers&&(o.headers=e.headers),e.headers&&e.headers["Content-Type"]&&(o.contentType=e.headers["Content-Type"]),console.log(o),jQuery.ajax(o)},n=function(t){if(!e.WebSocket)throw new Error("Browser does not support WebSocket!");var o=new e.WebSocket(t);return o.binaryType="arraybuffer",o._onevent={},o._delayed=[],o._emit=function(e,t){var n=o._onevent[e];n?t?n(t):n():o._delayed.push({name:e,data:t})},o.onopen=function(e){o._emit("open")},o.onclose=function(e){o._emit("close")},o.onmessage=function(e){o._emit("read",new Uint8Array(e.data))},o.onerror=function(e){o._emit("error",e)},o._on=o.on,o.on=function(e,t){if(!o._onevent[e])for(var n=0;o._delayed[n++];){var r=o._delayed[n];r.name==e&&(r.data?t(r.data):t()),o._delayed.splice(n,1),n--}o._onevent[e]=t},o.write=function(e){o.send(e),o._emit("write",e)},o},"jquery"}t.prototype.list=function(e){this.request({method:"GET",route:"api/v1/port"},e)},t.prototype.status=function(e,t){this.request({method:"GET",route:"api/v1/port/"+e},t)},t.prototype.open=function(e,t,o){this.request({method:"POST",route:"api/v1/port/"+e+"/open",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t||{})},o)},t.prototype.close=function(e,t){this.request({method:"POST",route:"api/v1/port/"+e+"/close",headers:{Accept:"application/json"}},t)},t.prototype.write=function(e,t,o){this.request({method:"POST",route:"api/v1/port/"+e+"/write",headers:{Accept:"application/json","Content-Type":"application/octet-stream"},body:t},o)},t.prototype.read=function(e,t){this.request({method:"GET",route:"api/v1/port/"+e+"/read",headers:{Accept:"application/json"}},t)},t.prototype.clearReadBuffer=function(e,t){this.request({method:"DELETE",route:"api/v1/port/"+e+"/read",headers:{Accept:"application/json"}},t)},t.prototype.available=function(e,t){this.request({method:"GET",route:"api/v1/port/"+e+"/available",headers:{Accept:"application/json"}},t)},t.prototype.bind=function(e,t){if(!t)throw new Error("Missing serial port name!");if("data"!=e&&"control"!=e)throw new Error("Only 'data' and 'control' line allowed!");var o=n("ws://localhost:5147/api/v1/port/"+t+"/"+e);return"control"==e&&(o.open=function(e){var t={event:"open",data:e};o.send(JSON.stringify(t)),o._emit("write",e)}),o},t.prototype.on=function(e,t){this.events[e]=t},"object"==typeof exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):e.RemoteSerialPort=t}(this);